<!DOCTYPE html>
<html>

<head>
  <title>Futterautomat</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <link rel="stylesheet" type="text/css" href="/styleMobile.css">
  <link rel="stylesheet" type="text/css" href="/styleAddon.css">
  <style>
    :root {
      --ColorHome: var(--contrast);
      --ColorConfig: var(--secondary);
      --ColorWiFi: var(--secondary);
      --ColorSystem: var(--secondary)
    }
  </style>
  <script src="/view.js"></script>
  <script type="text/javascript">
    console.log("Start");
    function handleWsMsg(msg) {
      if (ConfigDone) {
        let _elements = JSON.parse(msg.data);
        let _Spindel = _elements.Spindel;
        let _Futter = _elements.Futter;
        let elements = document.getElementById("elements");
        let Spindel = getViewSlave(elements, "Spindel");
        let Futter = getViewSlave(elements, "Futter");
        Object.keys(_Spindel.config).forEach(key => {
          let tag = getViewTag(Spindel, key);
          updateViewTag(tag, _Spindel.config[key]);
        });
        Object.keys(_Futter.config).forEach(key => {
          let tag = getViewTag(Futter, key);
          updateViewTag(tag, _Futter.config[key]);
        });
      }
    }

    var ws = new WebSocket("ws://" + location.host + "/ws");
    ws.onmessage = function (_msg) {
      handleWsMsg(_msg);
    };

    function showConfig() {
      fetch("/usrConfig.json")
        .then(response => {
          return response.json();
        }).then(config => {
          //Get Slaves from Config-File
          console.log(config);
          let elements = document.getElementById("elements");

          //Creat a DIV for each Function that contains the tags
          console.log(config);
          Object.keys(config).forEach(key => {
            createViewSlave(elements, key, config[key].config);
          });
          ConfigDone = true;
        });
    }
    document.addEventListener("DOMContentLoaded", showConfig);
    console.log("done");

  </script>
</head>

<body>
  <nav class="container-fluid">
    <ul>
      <li>%SVG_LOGO%</li>
      <li>Online Daten</li>
    </ul>
    <ul>
      <li>
        <a href="/home.htm">%SVG_HOME%</a>
      </li>
      <li>
        <a href="/config.htm">%SVG_CONFIG%</a>
      </li>
      <li>
        <a href="/connect">%SVG_WIFI%</a>
      </li>
      <li>
        <a href="/sys">%SVG_SYSTEM%</a>
      </li>
    </ul>
  </nav>
  <main class="container">
    <section id="elements">

    </section>
  </main>
</body>

</html>