<!DOCTYPE html>
<html>

<head>
  <title>%TITLE%</title>
  <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link rel="stylesheet" type="text/css" href="/style/style.css">
  <link rel="stylesheet" type="text/css" href="/style/styleMobile.css">
  <link rel="stylesheet" type="text/css" href="/style/styleAddon.css">
  <style>
    :root {
      --ColorHome: var(--secondary);
      --ColorConfig: var(--secondary);
      --ColorWiFi: var(--contrast);
      --ColorSystem: var(--secondary)
    }
  </style>
  <script src="/wifi.js"></script>
  <script type="text/javascript">
    function onAdd() {
      let ViewElements = document.getElementById("elements");
      let ViewElement = createWiFiElement(ViewElements);
    }

    function onDelete(Element) {
      Element.parentElement.remove();
    }

    function onSaveConfig() {
      let ViewElements = document.querySelectorAll("article");
      let WiFiList = [];
      ViewElements.forEach((ViewElement, EIndex) => {
        WiFiList.push(getWiFiObject(ViewElement));
      });
      fetch("http://" + location.host + "/sysConfig.json")
        .then(response => {
          return response.json();
        })
        .then(data => {
          // WiFi-Config ersetzen
          data["wifi"] = WiFiList;
          // Config-File erzeugen
          let ConfigFile = new File([JSON.stringify(data)], "sysConfig.json", {type: "application/json"});
          let Form = new FormData();
          Form.append("action", "/upload");
          Form.append("userfile", ConfigFile);
          fetch("http://" + location.host + "/upload", {
            method: 'POST',
            body: Form
          })
          .then(response => {
            console.log("Done:", response);
          })
          .catch(error => {
            console.error("Failed:", error);
          });
        });
    }

    fetch("http://" + location.host + "/sysConfig.json")
      .then(response => {
        return response.json();
      })
      .then(data => {
        //Loop Elements
        if ("wifi" in data) {
          let DataElements = data.wifi;
          let ViewElements = document.getElementById("elements");
          DataElements.forEach((DataElement, EIndex) => {
            if ((typeof DataElement === "object") && (DataElement !== null)) {
              let ViewElement = createWiFiElement(ViewElements);
              setWiFiElement(ViewElement, DataElement);
            }
          });
        }
      });
  </script>
</head>

<body>
  <nav class="container-fluid">
    <ul>
      <li>%SVG_LOGO%</li>
      <li>Konfiguration</li>
    </ul>
    <ul>
      <li><a href="/home.htm">%SVG_HOME%</a></li>
      <li><a href="/config.htm">%SVG_CONFIG%</a></li>
      <li><a href="/connect">%SVG_WIFI%</a></li>
      <li><a href="/sys">%SVG_SYSTEM%</a></li>
    </ul>
  </nav>
  <main class="container">
    <section id="elements">
    </section>
    <button onclick="onAdd()">Add Config</button>
    <button onclick="onSaveConfig()">Save Config</button>
  </main>
</body>
</ht???